# 备忘录

> ```kotlin
> {
>   "code": "string",
>   "password": "E4w6bemu/TxxxpmNmfqe7VowZKSm4ixdrfYm4N66wEZBkm7AOWTFHGHT0Qyg+7BNZtJKfAqfLtU5qu0oyZ2iaA==",
>   "username": "admin",
>   "uuid": "string"
> }
> ```

``````kotlin
prod:
url: 47.99.125.190
120.55.91.3(后端）
root/JuN2TR6lp_VzaEwm


dev
10.5.19.121(183.129.174.186) qjy-statics (云服务器） zjlab/DesEK8k4Epid
mysql，sudo su 然后root 123456/空
测试环境DB可公网访问：
10.5.19.121(183.129.174.186)
3306
test/zj12345678
``````



## git项目

### web

``````kotlin
https://github.com/woai3c/vue-admin-template

https://github.com/lin-xin/vue-manage-system.git
``````

``````kotlin
/home/data/doc/img

docker run -p 80:80 --name nginx  -v $PWD/logs:/www/logs -v $PWD/html:/etc/nginx/html  -d nginx



http { 
  include    mime.types; 
  default_type application/octet-stream; 
   
  log_format main '$remote_addr - $remote_user [$time_local] "$request" ' 
              '$status $body_bytes_sent "$http_referer" ' 
           '"$http_user_agent" "$http_x_forwarded_for"'; 
   
  access_log logs/access.log main; 
   
  sendfile    on; 
  #tcp_nopush   on;   
  #keepalive_timeout 0; 
  keepalive_timeout 65; 
  #gzip on;  
  server { 
    listen    80;#端口号 
    server_name localhost;#本机 
    charset utf-8; 
    #access_log logs/host.access.log main;  
     location ~ .*\.(gif|jpg|jpeg|png)$ { 
      expires 24h; 
      root /home/images/;#指定图片存放路径 
      access_log /usr/local/nginx/logs/images.log;#日志存放路径 
      proxy_store on; 
      proxy_store_access user:rw group:rw all:rw; 
      proxy_temp_path     /home/images/;#图片访问路径 
      proxy_redirect     off; 
      proxy_set_header    Host 127.0.0.1; 
      client_max_body_size  10m; 
      client_body_buffer_size 1280k; 
      proxy_connect_timeout  900; 
      proxy_send_timeout   900; 
      proxy_read_timeout   900; 
      proxy_buffer_size    40k; 
      proxy_buffers      40 320k; 
      proxy_busy_buffers_size 640k; 
      proxy_temp_file_write_size 640k; 
      if ( !-e $request_filename) 
      { 
         proxy_pass http://127.0.0.1;#默认80端口 
      } 
     }   
    location / { 
      root  /home/html; #html访问路径
      index index.html index2.htm; #html文件名称
  }

``````



``````
eydkbkvonnjvbaii


  # 邮箱配置
  mail:
    host: smtp.163.com
    # 邮件的发送者 163邮箱(开发测试时使用 发送延时 20秒，每天发送量限制 50)
    username: dubhe_ai@163.com
    # SMTP授权密码
    password: DOZXSADOUDXWGVUW
    protocol: smtp
    properties.mail.smtp.auth: true
    properties.mail.smtp.port: 465 #465或者994
    properties.mail.smtp.starttls.enable: true
    properties.mail.smtp.starttls.required: true
    properties.mail.smtp.ssl.enable: true
    default-encoding: utf-8
``````



### nacos配置

#### system-dev.yaml

``````kotlin
spring:
  zipkin:
    discoveryClientEnabled: false
    # 服务端地址
    base-url: http://localhost:9411/ 
    sender:
    # 数据传输方式，web 表示以 HTTP 报文的形式向服务端发送数据
      type: web                      
  sleuth:
    sampler:
    # 收集数据百分比，默认 0.1（10%）
      probability: 1.0               
  cloud:
#    consul: #Consul服务注册发现配置
#      host: localhost
#      port: 8500
#      discovery:
#        service-name: ${spring.application.name}
#    nacos:
#      discovery:
#        server-addr: localhost:8848 #配置Nacos地址

    stream:
      binders: # 在此处配置要绑定的rabbitMQ的服务信息
        defaultRabbit: # 表示定义的名称，用于binding的整合
          # 消息中间件类型
          type: rabbit
          environment: # 设置rabbitMQ的相关环境配置
            spring:
              rabbitmq:
                host: localhost
                port: 5672
                username: guest
                password: guest
      bindings: # 服务的整合处理
        output: # 这个名字是一个通道的名称
          # 表示要使用的exchange名称定义
          destination: studyExchange
          # 设置消息类型，本次为json，文本则设为text/plain
          content-type: application/json
          # 设置要绑定的消息服务的具体设置
          binder: defaultRabbit

  datasource:
    url: jdbc:mysql://localhost:3306/zc?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&characterEncoding=utf8
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    ################ Redis 基础配置 ##############
  redis:
    host: 127.0.0.1
    port: 6379
    password: Cxt1997116 
    timeout: 10000
    lettuce:
      pool:
        # 连接池最大连接数
        max-active: 8
        # 连接池最大阻塞等待时间（使用负值表示没有限制）
        max-wait: -1ms
        # 连接池中的最小空闲连接
        min-idle: 0
        # 连接池中的最大空闲连接
        max-idle: 8
  main:
    allow-bean-definition-overriding: true
  #邮件信息
  mail:
    host: smtp.163.com
    # 邮件的发送者 163邮箱(开发测试时使用)
    username: hb_cxtl@163.com
    # SMTP授权密码
    password: AKXPGSLFFMPZJHEH
    protocol: smtp
    properties.mail.smtp.auth: true
    properties.mail.smtp.port: 465 #465或者994
    properties.mail.smtp.starttls.enable: true
    properties.mail.smtp.starttls.required: true
    properties.mail.smtp.ssl.enable: true
    default-encoding: utf-8

  session:
    store-type: redis
    #rocketmq:
#  # 生产者配置
#  producer:
#    groupName: ${spring.application.name}
#    namesrvAddr: 127.0.0.1:8088
#    default: false

# mybatis配置
mybatis-plus:
  mapper-locations: classpath:mybatis/mapper/*.xml
  # config-location: classpath:/mybatis/mybatis-spring.xml
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
management:
  endpoints:
    web:
      cors:
        allowed-methods: '*'
feign:
  sentinel:
    enabled: true
  client:
    config:
      default:
        # 设置Fegin的超时时间
        connectTimeout: 3000
        readTimeout: 3000
  hystrix:
    enabled: false

logging:
  level:
    root: info #日志配置DEBUG,INFO,WARN,ERROR
    com.macro.mall: debug

### jwt
jwt:
  ###过期时间 单位s #60*60*24
  time: 86400
  ###安全密钥
  secret: "ZmQ0ZGI5NjQ0MDQwY2I4MjMxY2Y3ZmI3MjdhN2ZmMjNhODViOTg1ZGE0NTBjMGM4NDA5NzYxMjdjOWMwYWRmZTBlZjlhNGY3ZTg4Y2U3YTE1ODVkZDU5Y2Y3OGYwZWE1NzUzNWQ2YjFjZDc0NGMxZWU2MmQ3MjY1NzJmNTE0MzI="
  ###token前缀
  prefix: "Bearer"
  ###http头key
  header: "Authorization"
  ###签名主题
  subject: "dupake"
  ###角色权限声明
  claims: "role"

#密码加密传输，前端公钥加密，后端私钥解密
rsa:
  private_key: MIIBUwIBADANBgkqhkiG9w0BAQEFAASCAT0wggE5AgEAAkEA0vfvyTdGJkdbHkB8mp0f3FE0GYP3AYPaJF7jUd1M0XxFSE2ceK3k2kw20YvQ09NJKk+OMjWQl9WitG9pB6tSCQIDAQABAkA2SimBrWC2/wvauBuYqjCFwLvYiRYqZKThUS3MZlebXJiLB+Ue/gUifAAKIg1avttUZsHBHrop4qfJCwAI0+YRAiEA+W3NK/RaXtnRqmoUUkb59zsZUBLpvZgQPfj1MhyHDz0CIQDYhsAhPJ3mgS64NbUZmGWuuNKp5coY2GIj/zYDMJp6vQIgUueLFXv/eZ1ekgz2Oi67MNCk5jeTF2BurZqNLR3MSmUCIFT3Q6uHMtsB9Eha4u7hS31tj1UWE+D+ADzp59MGnoftAiBeHT7gDMuqeJHPL4b+kC+gzV4FGTfhR9q3tTbklZkD2A==
  public_key: MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANL378k3RiZHWx5AfJqdH9xRNBmD9wGD2iRe41HdTNF8RUhNnHit5NpMNtGL0NPTSSpPjjI1kJfVorRvaQerUgkCAwEAAQ==

secure:
  ignored:
    urls: #安全路径白名单
      - /swagger-ui.html
      - /swagger-resources/**
      - /swagger/**
      - /**/v2/api-docs
      - /**/*.js
      - /**/*.css
      - /**/*.png
      - /**/*.ico
      - /webjars/springfox-swagger-ui/**
      - /**
``````

#### finance-dev.yaml

``````kotlin
spring:
  zipkin:
    discoveryClientEnabled: false
    base-url: http://localhost:9411/ # 服务端地址
    sender:
      type: web                      # 数据传输方式，web 表示以 HTTP 报文的形式向服务端发送数据
  sleuth:
    sampler:
      probability: 1.0               # 收集数据百分比，默认 0.1（10%）
  cloud:
    stream:
      binders: # 在此处配置要绑定的rabbitMQ的服务信息
        defaultRabbit: # 表示定义的名称，用于binding的整合
          # 消息中间件类型
          type: rabbit
          environment: # 设置rabbitMQ的相关环境配置
            spring:
              rabbitmq:
                host: localhost
                port: 5672
                username: guest
                password: guest
      bindings: # 服务的整合处理
        output: # 这个名字是一个通道的名称
          # 表示要使用的exchange名称定义
          destination: studyExchange
          # 设置消息类型，本次为json，文本则设为text/plain
          content-type: application/json
          # 设置要绑定的消息服务的具体设置
          binder: defaultRabbit

  datasource:
    url: jdbc:mysql://localhost:3306/zc?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&characterEncoding=utf8
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    ################ Redis 基础配置 ##############
  redis:
    host: 127.0.0.1
    port: 6379
    password: Cxt1997116 
    timeout: 10000
    lettuce:
      pool:
        # 连接池最大连接数
        max-active: 8
        # 连接池最大阻塞等待时间（使用负值表示没有限制）
        max-wait: -1ms
        # 连接池中的最小空闲连接
        min-idle: 0
        # 连接池中的最大空闲连接
        max-idle: 8

  session:
    store-type: redis
    #rocketmq:
#  # 生产者配置
#  producer:
#    groupName: ${spring.application.name}
#    namesrvAddr: 127.0.0.1:8088
#    default: false

# mybatis配置
mybatis-plus:
  mapper-locations: classpath:mybatis/mapper/*.xml
  # config-location: classpath:/mybatis/mybatis-spring.xml
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl


logging:
  level:
    root: info #日志配置DEBUG,INFO,WARN,ERROR
    com.macro.mall: debug

``````

#### report-dev.yaml

``````kotlin
spring:
  elasticsearch:
    rest:
      scheme: http
      ip-address: 127.0.0.1:9200
  zipkin:
    discoveryClientEnabled: false
    base-url: http://localhost:9411/ # 服务端地址
    sender:
      type: web                      # 数据传输方式，web 表示以 HTTP 报文的形式向服务端发送数据
  sleuth:
    sampler:
      probability: 1.0               # 收集数据百分比，默认 0.1（10%）
  cloud:
    stream:
      binders: # 在此处配置要绑定的rabbitMQ的服务信息
        defaultRabbit: # 表示定义的名称，用于binding的整合
          # 消息中间件类型
          type: rabbit
          environment: # 设置rabbitMQ的相关环境配置
            spring:
              rabbitmq:
                host: localhost
                port: 5672
                username: guest
                password: guest
      bindings: # 服务的整合处理
        output: # 这个名字是一个通道的名称
          # 表示要使用的exchange名称定义
          destination: studyExchange
          # 设置消息类型，本次为json，文本则设为text/plain
          content-type: application/json
          # 设置要绑定的消息服务的具体设置
          binder: defaultRabbit

  datasource:
    url: jdbc:mysql://localhost:3306/zc?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&characterEncoding=utf8
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver
    ################ Redis 基础配置 ##############
  redis:
    host: 127.0.0.1
    port: 6379
    password: Cxt1997116 
    timeout: 10000
    lettuce:
      pool:
        # 连接池最大连接数
        max-active: 8
        # 连接池最大阻塞等待时间（使用负值表示没有限制）
        max-wait: -1ms
        # 连接池中的最小空闲连接
        min-idle: 0
        # 连接池中的最大空闲连接
        max-idle: 8

  session:
    store-type: redis
    #rocketmq:
#  # 生产者配置
#  producer:
#    groupName: ${spring.application.name}
#    namesrvAddr: 127.0.0.1:8088
#    default: false

# mybatis配置
mybatis-plus:
  mapper-locations: classpath:mybatis/mapper/*.xml
  # config-location: classpath:/mybatis/mybatis-spring.xml
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
feign:
  sentinel:
    enabled: true
  client:
    config:
      default:
        # 设置Fegin的超时时间
        connectTimeout: 3000
        readTimeout: 3000
  hystrix:
    enabled: false

logging:
  level:
    root: info #日志配置DEBUG,INFO,WARN,ERROR
    com.macro.mall: debug

``````

#### gateway-dev.yaml

``````kotlin
spring:
  zipkin:
    discoveryClientEnabled: false
    # 服务端地址
    base-url: http://localhost:9411/
    sender:
      # 数据传输方式，web 表示以 HTTP 报文的形式向服务端发送数据
      type: web
  sleuth:
    sampler:
      # 收集数据百分比，默认 0.1（10%）
      probability: 1.0
  cloud:
    globalcors: #网关支持跨域问题
    cors-configurations:
      '[/**]':
        allowedOrigins: "*" # * 表示所有
        allowedMethods:
          - GET
          - POST
          - PUT
    gateway:
      discovery:
        locator:
          #表明gateway开启服务注册和发现的功能，并且spring cloud gateway自动根据服务发现为每一个服务创建了一个router，这个router将以服务名开头的请求路径转发到对应的服务。
          enabled: true
          #是将请求路径上的服务名配置为小写（因为服务注册的时候，向注册中心注册时将服务名转成大写的了），比如以/service-hi/*的请求路径被路由转发到服务名为service-hi的服务上。
          lower-case-service-id: true
      routes:
        #此配置的值注册到Nacos中服务提供者的spring.application.name的值
        - id: report-service
          uri: lb://report
          predicates:
            - Path=/report/**
          filters:
              #代表截取路径的个数
            - StripPrefix=1

        - id: finance-service
          uri: lb://finance
          predicates:
            - Path=/finance/**
          filters:
            #代表截取路径的个数
            - StripPrefix=1

        - id: system-service
          uri: lb://system
          predicates:
            - Path=/system/**

    stream:
      binders: # 在此处配置要绑定的rabbitMQ的服务信息
        defaultRabbit: # 表示定义的名称，用于binding的整合
          # 消息中间件类型
          type: rabbit
          environment: # 设置rabbitMQ的相关环境配置
            spring:
              rabbitmq:
                host: localhost
                port: 5672
                username: guest
                password: guest
      bindings: # 服务的整合处理
        output: # 这个名字是一个通道的名称
          # 表示要使用的exchange名称定义
          destination: studyExchange
          # 设置消息类型，本次为json，文本则设为text/plain
          content-type: application/json
          # 设置要绑定的消息服务的具体设置
          binder: defaultRabbit

  datasource:
    url: jdbc:mysql.sql://localhost:3306/zc?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&characterEncoding=utf8
    username: root
    password: 123456
    driver-class-name: com.mysql.sql.cj.jdbc.Driver
    ################ Redis 基础配置 ##############
  redis:
    host: 127.0.0.1
    port: 6379
    password: Cxt1997116 
    timeout: 10000
    lettuce:
      pool:
        # 连接池最大连接数
        max-active: 8
        # 连接池最大阻塞等待时间（使用负值表示没有限制）
        max-wait: -1ms
        # 连接池中的最小空闲连接
        min-idle: 0
        # 连接池中的最大空闲连接
        max-idle: 8

  session:
    store-type: redis
    #rocketmq:
#  # 生产者配置
#  producer:
#    groupName: ${spring.application.name}
#    namesrvAddr: 127.0.0.1:8088
#    default: false

# mybatis配置
mybatis-plus:
  mapper-locations: classpath:mybatis/mapper/*.xml
  # config-location: classpath:/mybatis/mybatis-spring.xml
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
management:
  endpoints:
    web:
      cors:
        allowed-methods: '*'
feign:
  sentinel:
    enabled: true
  client:
    config:
      default:
        # 设置Fegin的超时时间
        connectTimeout: 3000
        readTimeout: 3000
  hystrix:
    enabled: false

logging:
  level:
    root: info #日志配置DEBUG,INFO,WARN,ERROR
    com.macro.mall: debug

``````



### 服务器

``````
118.89.173.93

O!eZCxLMBv1iAmBg

Mypwd123!

10.5.24.119 zjlab zjlab@321
/home/dataTest/logs

sudo scp /home/xt/data/workspace/zj-workspace/dubhe-server/dubhe-admin/target/dubhe-admin-1.0.jar zjlab@10.5.24.119:/home/dataTest

nohup java -jar dubhe-admin-1.0.jar --spring.profiles.active=dev --server.port=8888 &


scp  /home/xt/data/workspace/xt-workspace/baby-manage-server/baby-finance/target/baby-finance-0.0.1-SNAPSHOT.jar root@118.89.173.93:/home/data/baby/finance


scp  /home/xt/data/workspace/xt-workspace/baby-manage-server/baby-report/target/baby-report-0.0.1-SNAPSHOT.jar root@118.89.173.93:/home/data/baby/report

scp  /home/xt/data/workspace/xt-workspace/baby-manage-server/baby-system/target/baby-system-0.0.1-SNAPSHOT.jar root@118.89.173.93:/home/data/baby/system

10.5.19.121(183.129.174.186) qjy-statics (云服务器） zjlab/DesEK8k4Epid root/DesEK8k4Epid
mysql，sudo su 然后root 123456/空
测试环境DB可公网访问：
10.5.19.121(183.129.174.186)
3306
test/zj12345678
logs
``````

``````
docker run -d -p 80:80 --name nginx -v /home/xt/data/docker/nginx/nginx.conf:/etc/nginx/nginx.conf -v /home/xt/data/docker/nginx/conf.d:/etc/nginx/conf.d -v /home/xt/data/docker/nginx/logs:/var/log/nginx nginx

``````

#### 报表请求参数

``````sql
2020-07-27 00:00:00  1595779200000
2020-07-28 00:00:00  1595865600000
2020-07-29 00:00:00  1595952000000
2020-07-30 00:00:00  1596038400000
2020-07-31 00:00:00  1596124800000
``````

### 启动脚本

#### start.sh

``````kotlin
#!/bin/sh
#Startup application.
#-----------------------------------------------------------------------------
filename = baby-system-0.0.1-SNAPSHOT.jar
JAVA_OPTIONS="-Xmx128m -Xms64m -Dfile.encoding=utf-8 "
for filename in `ls -t *.jar`;
do
	count=`ps -ef|grep $filename|grep -v grep|wc -l`
	if [ $count -eq 0 ]
	then
		echo "*** starting [$filename]... ***"
		#启动命令
		nohup java $JAVA_OPTIONS -jar $filename > logs/system.log 2>&1 &
		echo "*** [$filename] start success! ***" 
	else
		echo "*** [$filename] already runing... ***"
	fi
	break;
done
``````

> chmod +x start.sh

#### restart.sh

``````kotlin
#!/bin/bash
name=baby-system-0.0.1-SNAPSHOT.jar
PID=$(ps -ef | grep $name |grep -v grep|awk '{print $2}')

if [ $? -eq 0 ]; then
    echo "process id:$PID"
	sudo kill -9 $PID
	if [ $? -eq 0 ];then
    echo "kill $name success"
	else
    echo "kill $name fail"
	fi
else
    echo "process $name not exist"
    exit
fi
./start.sh
``````

> chmod +x restart.sh

#### stop.sh

```````kotlin
#!/bin/sh

# Shutdown application.
# -----------------------------------------------------------------------------

filename=baby-system-0.0.1-SNAPSHOT.jar
#检查进程是否已经存在
count=`ps -ef|grep $filename|grep -v grep|wc -l`
if [ $count -eq 0 ]
then
        echo "*** [$filename] Not Runing... ***"
else
        echo "*** Shutting down [$filename]... ***"
        #停止命令
	pid=`ps -ef|grep $filename|grep -v grep| awk '{print $2}'`
	echo $pid
	kill -9 $pid
        echo "*** [$filename] Shutdown Success! ***"
fi

```````

> chmod +x stop.sh

> ```
> 10.5.24.119 zjlab zjlab@321
> /home/dataTest/logs
> 
> http://10.5.26.234:9000/dubhe-dev/dataset/22650/origin/9f9bnk6ut__ts1597905338015490_0_1597905435276.jpg
> http://10.5.26.234:9000/dubhe-dev/dataset/22650/origin/9f9BNK6Ut__ts1597905338015490_0_1597905435276.jpg
> ```

>
>
>#!/bin/sh
>#Startup application.
>#-----------------------------------------------------------------------------
>filename = dubhe-admin-1.0.jar
>for filename in `ls -t *.jar`;
>do
>	count=`ps -ef|grep $filename|grep -v grep|wc -l`
>	if [ $count -eq 0 ]
>	then
>		echo "*** starting [$filename]... ***"
>		#启动命令
>		nohup java  -jar $filename  --spring.profiles.active=dev --server.port=8888 > logs/dubhe-admin.log 2>&1 &
>		echo "*** [$filename] start success! ***" 
>	else
>		echo "*** [$filename] already runing... ***"
>	fi
>	break;
>done







#!/bin/bash
name=dubhe-admin-1.0.jar
PID=$(ps -ef | grep $name |grep -v grep|awk '{print $2}')

if [ $? -eq 0 ]; then
    echo "process id:$PID"
	sudo kill -9 $PID
	if [ $? -eq 0 ];then
    echo "kill $name success"
	else
    echo "kill $name fail"
	fi
else
    echo "process $name not exist"
    exit
fi
./start.sh