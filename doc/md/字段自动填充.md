#  自动填充

## 1 自动填充功能

> 新增 createUserId \ updateUserId \ createTime \ deleted \ updateTime 字段值 自动填充功能

## 2 字段自动填充必要条件

> 基于mybatisplus 自动填充功能，实现元对象处理器接口：com.baomidou.mybatisplus.core.handlers.MetaObjectHandler
>
> 支持 insert \ update 自动填充

## 3  字段自动填充触发场景

> 使用 mybatisplus 语法 执行 insert / update 方法

## 4 代码示例

> 注解填充字段 @TableField(.. fill = FieldFill.INSERT) 生成器策略部分也可以配置！

> ``````java
> public class User {
> 
>     // 注意！这里需要标记为填充字段
>     @TableField(.. fill = FieldFill.INSERT)
>     private String fillField;
> 
>     ....
> }
>   
> ``````

> 自定义实现类 MetaHandlerConfig

> ``````java
> @Component
> public class MetaHandlerConfig implements MetaObjectHandler {
> 
> 
>     /**
>      * 新增数据执行
>      *
>      * @param metaObject
>      */
> 
>     @Override
>     public void insertFill(MetaObject metaObject) {
>         if (Objects.isNull(getFieldValByName("createTime", metaObject))) {
>             this.setFieldValByName("createTime", DateUtil.getCurrentTimestamp(), metaObject);
>         }
>         if (Objects.isNull(getFieldValByName("updateTime", metaObject))) {
>             this.setFieldValByName("updateTime", DateUtil.getCurrentTimestamp(), metaObject);
>         }
>         if (Objects.isNull(getFieldValByName("updateUserId", metaObject))) {
>             this.setFieldValByName("updateUserId", getUserId(), metaObject);
>         }
>         if (Objects.isNull(getFieldValByName("createUserId", metaObject))) {
>             this.setFieldValByName("createUserId", getUserId(), metaObject);
>         }
>         if (Objects.isNull(getFieldValByName("deleted", metaObject))) {
>             this.setFieldValByName("deleted",   SwitchEnum.getBooleanValue(SwitchEnum.NO.getValue()), metaObject);
>         }
>     }
> 
>     /**
>      * 更新数据执行
>      *
>      * @param metaObject
>      */
>     @Override
>     public void updateFill(MetaObject metaObject) {
> 
> 
>         if (Objects.isNull(getFieldValByName("updateTime", metaObject))) {
>             this.setFieldValByName("updateTime", DateUtil.getCurrentTimestamp(), metaObject);
>         }
>         if (Objects.isNull(getFieldValByName("updateUserId", metaObject))) {
>             this.setFieldValByName("updateUserId", getUserId(), metaObject);
>         }
> 
>     }
> 
> }
> 
> ``````

> 自动填充策略

> ``````java
> public enum FieldFill {
>     /**
>      * 默认不处理
>      */
>     DEFAULT,
>     /**
>      * 插入填充字段
>      */
>     INSERT,
>     /**
>      * 更新填充字段
>      */
>     UPDATE,
>     /**
>      * 插入和更新填充字段
>      */
>     INSERT_UPDATE
> }
> ``````

> 注意事项：
>
> 字段必须声明`TableField`注解,属性`fill`选择对应策略,该声明告知`Mybatis-Plus`需要预留注入`SQL`字段
>
> 填充处理器MetaHandlerConfig在 Spring Boot 中需要声明`@Component`或`@Bean`注入
>
> 要想根据注解`FieldFill.xxx`和`字段名`以及`字段类型`来区分必须使用父类的`strictInsertFill`或者`strictUpdateFill`方法
>
> 不需要根据任何来区分可以使用父类的`fillStrategy`方法

## 5 项目集成实战

> 需要自动填充的实体字段中添加   @TableField(```, fill = FieldFill.INSERT_UPDATE) 策略即可

> ``````java
> @Data
> @Builder
> @AllArgsConstructor
> @NoArgsConstructor
> @TableName("user")
> public class User implements Serializable {
>     ···
>  @TableField(value = "create_user_id",fill = FieldFill.INSERT)
>  private Long createUserId;
> 
>  @TableField(value = "update_user_id",fill = FieldFill.INSERT_UPDATE)
>  private Long updateUserId;
> 
>  @TableField(value = "create_time",fill = FieldFill.INSERT)
>  private Timestamp createTime;
> 
>  @TableField(value = "deleted",fill = FieldFill.INSERT)
>  private Boolean deleted;
> 
>  @TableField(value = "update_time",fill = FieldFill.INSERT_UPDATE)
>  private Timestamp updateTime;
>     ···
> }
> ``````
>
>  
>

> 
